<div class="container">
	<div class="row justify-content-center">
		<div class="col-9">

			<form name="editForm" role="form" novalidate (ngSubmit)="save()" #editForm="ngForm" *ngIf="finished">

				<div>
					<h2 *ngIf="flow.id">
						<span>Edit Flow</span>
					</h2>
					<h2 *ngIf="!flow.id">
						<span>Create Flow</span>
					</h2>
				</div>

				<div>
					<jhi-alert-error></jhi-alert-error>
					<div class="form-group" id="flowId" [hidden]="!flowId">
						<label for="id">ID</label>
						<input type="text" class="form-control" id="id" name="id" *ngIf="flow" [(ngModel)]="flow.id" readonly />
					</div>
					<div class="form-group">
						<label class="form-control-label" for="field_name">Name</label>
						<input type="text" class="form-control" name="name" id="field_name" *ngIf="flow" [(ngModel)]="flow.name" />
					</div>
					<div class="form-group">
						<label class="form-control-label" for="field_name">Autostart</label>
						<select type="text" class="form-control" name="autoStart" id="field_autostart" *ngIf="flow" [(ngModel)]="flow.autoStart">
							<option value="true">true</option>
							<option value="false">false</option>
						</select>
					</div>
					<div class="form-group" *ngIf="!singleGateway">
						<label class="form-control-label" for="field_gateway">Gateway</label>
						<select class="form-control" id="field_gateway" name="gateway" *ngIf="flow" [(ngModel)]="flow.gatewayId">
							<option [ngValue]="null"></option>
							<option [ngValue]="gateway.id" *ngFor="let gateway of gateways">{{gateway.name}}</option>
						</select>
					</div>
					<div class="form-group" id="flowFromEndpoint" [hidden]="!flowFromEndpoint">
						<label class="form-control-label" for="field_fromEndpoint">From Endpoint</label>
						<input type="text" class="form-control" name="fromEndpoint" id="field_fromEndpoint" *ngIf="flow" [(ngModel)]="flow.fromEndpointId" />
					</div>
					<div class="form-group" id="flowErrorEndpoint" [hidden]="!flowErrorEndpoint">
						<label class="form-control-label" for="field_errorEndpoint">Error Endpoint</label>
						<input type="text" class="form-control" name="errorEndpoint" id="field_errorEndpoint" *ngIf="flow" [(ngModel)]="flow.errorEndpointId" />
					</div>

					<!-- styling of tabset is in global.css -->
					<ngb-tabset justify="justified">
						<ngb-tab title="From" id="fromTab">
							<ng-template ngbTabContent>
								<jhi-alert-error></jhi-alert-error>
								<div row id="tabBackground">
									<div class="col-12">
										<div class="form-group" id="fromEndpointId" [hidden]="!fromEndpointId">
											<label for="id">ID</label>
											<input type="text" class="form-control" id="id" name="id" [(ngModel)]="fromEndpoint.id" readonly />
										</div>
										<div class="form-group">
											<label class="form-control-label" for="field_from_type">Type</label>
											<div class="input-group">
												<ng-select name="type" [items]="types" [(ngModel)]="fromEndpoint.type" id="field_from_type" (change)="setTypeLinks(fromEndpoint, null, null)"></ng-select>
												<div class="input-group-append d-flex">
													<a role="button" class="btn btn-outline-secondary rounded-0" href="{{fromTypeAssimblyLink}}" [ngClass]="{'disabled': !fromTypeAssimblyLink}" target="_blank" title="Assimbly {{fromEndpoint.type | lowercase}} component documentation"><span class="fa fa-question"></span></a>
													<a role="button" class="btn btn-outline-secondary left-border-radius-0 camel-link" href="{{fromTypeCamelLink}}" [ngClass]="{'disabled': !fromTypeCamelLink}" target="_blank" title="Camel {{fromEndpoint.type | lowercase}} component documentation">
														<img src="../../../content/images/apache-camel.png"/>
													</a>
												</div>
											</div>
										</div>
										<div class="form-group">
											<label class="form-control-label" for="field_uri">Uri</label>
											<input type="text" class="form-control" name="uri" id="field_uri" [(ngModel)]="fromEndpoint.uri" />
										</div>
										<div class="form-group">
											<label class="form-control-label" for="field_options">Options</label>
											<div class="row mx-0 mb-1" *ngFor="let fromOption of fromEndpointOptions; let idx = index">
												<input type="text" class="col-5 right-border-radius-0 d-inline-block form-control" name="options-key-{{idx}}" id="field_options-key-{{idx}}" placeholder="key" [(ngModel)]="fromOption.key" />
												<input type="text" class="col-5 rounded-0 d-inline-block form-control" name="options-value-{{idx}}" id="field_options-value-{{idx}}" placeholder="value" [(ngModel)]="fromOption.value" />
												<button title="Add new option" type="button" class="col-1 rounded-0 btn btn-primary" (click)="addOption(fromEndpointOptions)"><span class="fa fa-plus"></span></button>
												<button title="Remove option" type="button" class="col-1 left-border-radius-0 btn btn-danger" (click)="removeOption(fromEndpointOptions, fromOption)" [disabled]="fromEndpointOptions.length === 1"><span class="fa fa-remove"></span></button>
											</div>
										</div>
										<div class="form-group">
											<label class="form-control-label" for="field_service">Service</label>
											<div class="input-group">
												<ng-select name="service" [items]="services" bindLabel="name" bindValue="id" [(ngModel)]="fromEndpoint.serviceId" id="field_service"></ng-select>
												<div class="input-group-append">
													<button *ngIf="serviceCreated && fromEndpoint.serviceId" class="btn btn-primary" (click)="createOrEditService(fromEndpoint)">
														<span class="fa fa-pencil"></span>&nbsp;
														<span>Edit service</span>
													</button>
													<button *ngIf="serviceCreated && !fromEndpoint.serviceId" class="btn btn-primary" (click)="createOrEditService(fromEndpoint)">
														<span class="fa fa-pencil"></span>&nbsp;
														<span>New service</span>
													</button>
													<button *ngIf="!serviceCreated" class="btn btn-primary" (click)="createOrEditService(fromEndpoint)">
														<span class="fa fa-pencil"></span>&nbsp;
														<span>Create service</span>
													</button>
												</div>
											</div>
										</div>
										<div class="form-group">
											<label class="form-control-label" for="field_header">Header</label>
											<div class="input-group">
												<ng-select name="header" [items]="headers" bindLabel="name" bindValue="id" [(ngModel)]="fromEndpoint.headerId" id="field_header"></ng-select>
												<div class="input-group-append">
													<button *ngIf="headerCreated && fromEndpoint.headerId" class="btn btn-primary" (click)="createOrEditHeader(fromEndpoint)">
														<span class="fa fa-pencil"></span>&nbsp;
														<span>Edit header</span>
													</button>
													<button *ngIf="headerCreated && !fromEndpoint.headerId" class="btn btn-primary" (click)="createOrEditHeader(fromEndpoint)">
														<span class="fa fa-pencil"></span>&nbsp;
														<span>New header</span>
													</button>
													<button *ngIf="!headerCreated" class="btn btn-primary" (click)="createOrEditHeader(fromEndpoint)">
														<span class="fa fa-pencil"></span>&nbsp;
														<span>Create header</span>
													</button>
												</div>
											</div>
										</div>
									</div>
								</div>
							</ng-template>
						</ngb-tab>
						<ngb-tab title="To" id="toTab">
							<ng-template ngbTabContent>
								<jhi-alert-error></jhi-alert-error>
								<div row id="tabBackground">
									<div class="col-12">
										<div class="form-group" id="toEndpointId" [hidden]="!toEndpointId">
											<label for="id">ID</label>
											<input type="text" class="form-control" id="id" name="id" [(ngModel)]="toEndpoint.id" readonly />
										</div>
										<div class="form-group">
											<label class="form-control-label" for="field_to_type">Type</label>
											<div class="input-group">
												<ng-select name="type" [items]="types" [(ngModel)]="toEndpoint.type" id="field_to_type" (change)="setTypeLinks(null, toEndpoint, null)"></ng-select>
												<div class="input-group-append d-flex">
													<a role="button" class="btn btn-outline-secondary rounded-0" href="{{toTypeAssimblyLink}}" [ngClass]="{'disabled': !toTypeAssimblyLink}" target="_blank" title="Assimbly {{toEndpoint.type | lowercase}} component documentation"><span class="fa fa-question"></span></a>
													<a role="button" class="btn btn-outline-secondary left-border-radius-0 camel-link" href="{{toTypeCamelLink}}" [ngClass]="{'disabled': !toTypeCamelLink}" target="_blank" title="Camel {{toEndpoint.type | lowercase}} component documentation">
														<img src="../../../content/images/apache-camel.png"/>
													</a>
												</div>
											</div>
										</div>
										<div class="form-group">
											<label class="form-control-label" for="field_uri">Uri</label>
											<input type="text" class="form-control" name="uri" id="field_uri" [(ngModel)]="toEndpoint.uri" />
										</div>
										<div class="form-group">
											<label class="form-control-label" for="field_options">Options</label>
											<div class="row mx-0 mb-1" *ngFor="let toOption of toEndpointOptions; let idx = index">
												<input type="text" class="col-5 right-border-radius-0 d-inline-block form-control" name="options-key-{{idx}}" id="field_options-key-{{idx}}" placeholder="key" [(ngModel)]="toOption.key" />
												<input type="text" class="col-5 rounded-0 d-inline-block form-control" name="options-value-{{idx}}" id="field_options-value-{{idx}}" placeholder="value" [(ngModel)]="toOption.value" />
												<button title="Add new option" type="button" class="col-1 rounded-0 btn btn-primary" (click)="addOption(toEndpointOptions)"><span class="fa fa-plus"></span></button>
												<button title="Remove option" type="button" class="col-1 left-border-radius-0 btn btn-danger" (click)="removeOption(toEndpointOptions, toOption)" [disabled]="toEndpointOptions.length === 1"><span class="fa fa-remove"></span></button>
											</div>
										</div>
										<div class="form-group" id="flowID2" [hidden]="!flowID2">
											<label class="form-control-label">Flow</label>
											<input type="text" class="form-control" id="field_flow" name="flow" [(ngModel)]="toEndpoint.flowId" />
										</div>
										<div class="form-group">
											<label class="form-control-label" for="field_service">Service</label>
 											<div class="input-group">
												<ng-select name="service" [items]="services" bindLabel="name" bindValue="id" [(ngModel)]="toEndpoint.serviceId" id="field_service"></ng-select>
												<div class="input-group-append">
													<button *ngIf="serviceCreated && toEndpoint.serviceId" class="btn btn-primary" (click)="createOrEditService(toEndpoint)">
														<span class="fa fa-pencil"></span>&nbsp;
														<span>Edit service</span>
													</button>
													<button *ngIf="serviceCreated && !toEndpoint.serviceId" class="btn btn-primary" (click)="createOrEditService(toEndpoint)">
														<span class="fa fa-pencil"></span>&nbsp;
														<span>New service</span>
													</button>
													<button *ngIf="!serviceCreated" class="btn btn-primary" (click)="createOrEditService(toEndpoint)">
														<span class="fa fa-pencil"></span>&nbsp;
														<span>Create service</span>
													</button>
												</div>
											</div>
										</div>
										<div class="form-group">
											<label class="form-control-label" for="field_header">Header</label>
											<div class="input-group">
												<ng-select name="header" [items]="headers" bindLabel="name" bindValue="id" [(ngModel)]="toEndpoint.headerId" id="field_header"></ng-select>
												<div class="input-group-append">
													<button *ngIf="headerCreated && toEndpoint.headerId" class="btn btn-primary" (click)="createOrEditHeader(toEndpoint)">
														<span class="fa fa-pencil"></span>&nbsp;
														<span>Edit header</span>
													</button>
													<button *ngIf="headerCreated && !toEndpoint.headerId" class="btn btn-primary" (click)="createOrEditHeader(toEndpoint)">
														<span class="fa fa-pencil"></span>&nbsp;
														<span>New header</span>
													</button>
													<button *ngIf="!headerCreated" class="btn btn-primary" (click)="createOrEditHeader(toEndpoint)">
														<span class="fa fa-pencil"></span>&nbsp;
														<span>Create header</span>
													</button>
												</div>
											</div>
										</div>
									</div>
								</div>
							</ng-template>
						</ngb-tab>
						<ngb-tab title="Error" id="errorTab">
							<ng-template ngbTabContent>
								<div row id="tabBackground">
									<div class="col-12">
										<div class="form-group" id="errorEndpointId" [hidden]="!errorEndpointId">
											<label for="id">ID</label>
											<input type="text" class="form-control" id="id" name="id" [(ngModel)]="errorEndpoint.id" readonly />
										</div>
										<div class="form-group">
											<label class="form-control-label" for="field_error_type">Type</label>
											<div class="input-group">
												<ng-select name="type" [items]="types" [(ngModel)]="errorEndpoint.type" id="field_error_type" (change)="setTypeLinks(null, null, errorEndpoint)"></ng-select>
												<div class="input-group-append d-flex">
													<a role="button" class="btn btn-outline-secondary rounded-0" href="{{errorTypeAssimblyLink}}" [ngClass]="{'disabled': !errorTypeAssimblyLink}" target="_blank" title="Assimbly {{errorEndpoint.type | lowercase}} component documentation"><span class="fa fa-question"></span></a>
													<a role="button" class="btn btn-outline-secondary left-border-radius-0 camel-link" href="{{errorTypeCamelLink}}" [ngClass]="{'disabled': !errorTypeCamelLink}" target="_blank" title="Camel {{errorEndpoint.type | lowercase}} component documentation">
														<img src="../../../content/images/apache-camel.png"/>
													</a>
												</div>
											</div>
										</div>
										<div class="form-group">
											<label class="form-control-label" for="field_uri">Uri</label>
											<input type="text" class="form-control" name="uri" id="field_uri" [(ngModel)]="errorEndpoint.uri" />
										</div>
										<div class="form-group">
											<label class="form-control-label" for="field_options">Options</label>
											<div class="row mx-0 mb-1" *ngFor="let errOption of errorEndpointOptions; let idx = index">
												<input type="text" class="col-5 right-border-radius-0 d-inline-block form-control" name="options-key-{{idx}}" id="field_options-key-{{idx}}" placeholder="key" [(ngModel)]="errOption.key" />
												<input type="text" class="col-5 rounded-0 d-inline-block form-control" name="options-value-{{idx}}" id="field_options-value-{{idx}}" placeholder="value" [(ngModel)]="errOption.value" />
												<button title="Add new option" type="button" class="col-1 rounded-0 btn btn-primary" (click)="addOption(errorEndpointOptions)"><span class="fa fa-plus"></span></button>
												<button title="Remove option" type="button" class="col-1 left-border-radius-0 btn btn-danger" (click)="removeOption(errorEndpointOptions, errOption)" [disabled]="errorEndpointOptions.length === 1"><span class="fa fa-remove"></span></button>
											</div>
										</div>
										<div class="form-group">
											<label class="form-control-label" for="field_service">Service</label>
											<div class="input-group">
												<ng-select name="service" [items]="services" bindLabel="name" bindValue="id" [(ngModel)]="errorEndpoint.serviceId" id="field_service"></ng-select>
												<div class="input-group-append">
													<button *ngIf="serviceCreated && errorEndpoint.serviceId" class="btn btn-primary" (click)="createOrEditService(errorEndpoint)">
														<span class="fa fa-pencil"></span>&nbsp;
														<span>Edit service</span>
													</button>
													<button *ngIf="serviceCreated && !errorEndpoint.serviceId" class="btn btn-primary" (click)="createOrEditService(errorEndpoint)">
														<span class="fa fa-pencil"></span>&nbsp;
														<span>New service</span>
													</button>
													<button *ngIf="!serviceCreated" class="btn btn-primary" (click)="createOrEditService(errorEndpoint)">
														<span class="fa fa-pencil"></span>&nbsp;
														<span>Create service</span>
													</button>
												</div>
											</div>
										</div>
										<div class="form-group">
											<label class="form-control-label" for="field_header">Header</label>
											<div class="input-group">
												<ng-select name="header" [items]="headers" bindLabel="name" bindValue="id" [(ngModel)]="errorEndpoint.headerId" id="field_header"></ng-select>
												<div class="input-group-append">
													<button *ngIf="headerCreated && errorEndpoint.headerId" class="btn btn-primary" (click)="createOrEditHeader(errorEndpoint)">
														<span class="fa fa-pencil"></span>&nbsp;
														<span>Edit header</span>
													</button>
													<button *ngIf="headerCreated && !errorEndpoint.headerId" class="btn btn-primary" (click)="createOrEditHeader(errorEndpoint)">
														<span class="fa fa-pencil"></span>&nbsp;
														<span>New header</span>
													</button>
													<button *ngIf="!headerCreated" class="btn btn-primary" (click)="createOrEditHeader(errorEndpoint)">
														<span class="fa fa-pencil"></span>&nbsp;
														<span>Create header</span>
													</button>
												</div>
											</div>
										</div>
									</div>
								</div>
							</ng-template>
						</ngb-tab>
					</ngb-tabset>
				</div>

				<div class="float-right">
					<button type="button" class="btn btn-secondary" (click)="goBack()">
						<span class="fa fa-ban"></span>&nbsp;
						<span>Cancel</span>
					</button>
					<button type="submit" [disabled]="editForm.form.invalid || isSaving" class="btn btn-primary">
						<span class="fa fa-save"></span>&nbsp;
						<span>Save</span>
					</button>
				</div>
				<div *ngIf="savingFlowFailed">
					<span class="text-danger">*{{savingFlowFailedMessage}}</span>
				</div>
			</form>
		</div>
	</div>
</div>
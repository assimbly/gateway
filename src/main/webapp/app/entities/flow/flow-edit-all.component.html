<div class="container">
	<div class="row justify-content-center">
		<div class="col-9">

			<form [formGroup]="editFlowForm" (ngSubmit)="save(false)" *ngIf="finished" novalidate class="needs-validation">
				<div>
					<h2 *ngIf="flow.id">
						<span>Edit Flow</span>
					</h2>
					<h2 *ngIf="!flow.id">
						<span>Create Flow</span>
					</h2>
				</div>
				<div>
					<jhi-alert-error></jhi-alert-error>
					<div class="form-group" id="flowId" [hidden]="!flowId">
						<label for="id">ID</label>
						<input type="text" class="form-control" id="id" *ngIf="flow" readonly formControlName="id" />
					</div>
					<div class="form-group">
						<label class="form-control-label" for="name">Name</label>
						<input type="text" class="form-control" id="name" *ngIf="flow" formControlName="name" />
						<div *ngIf="editFlowForm.controls.name.errors && (editFlowForm.controls.name.dirty || editFlowForm.controls.name.touched)">
							<div *ngIf="editFlowForm.controls.name.errors.required" class="invalid-field-message">Name is required.</div>
						</div>
					</div>
					<div class="form-group">
						<label class="form-control-label" for="field_autostart">Autostart</label>
						<select type="text" class="form-control" id="field_autostart" *ngIf="flow" formControlName="autoStart" data-toggle="tooltip" title="Starts the flow automatically when the gateway is started">
							<option value="true">true</option>
							<option value="false">false</option>
						</select>
					</div>
					<div class="form-group">
						<label class="form-control-label" for="field_offloading">Offloading</label>
						<select type="text" class="form-control" id="field_offloading" *ngIf="flow" formControlName="offloading" data-toggle="tooltip" title="When true, sends a copy of every message to the wiretap endpoint as configured under offloading settings">
							<option value="true">true</option>
							<option value="false">false</option>
						</select>
					</div>
					<div class="form-group" *ngIf="!singleGateway">
						<label class="form-control-label" for="field_gateway">Gateway</label>
						<select class="form-control" id="field_gateway" *ngIf="flow" formControlName="gateway">
							<option [ngValue]="gateway.id" *ngFor="let gateway of gateways">{{gateway.name}}</option>
						</select>
					</div>

					<!-- styling of tabset is in global.css -->
					<ngb-tabset justify="justified" formArrayName="endpointsData" (tabChange)="next(false, false, $event)" #tabs>
						<ngb-tab title="From" id="fromTab">
							<ng-template ngbTabContent>
								<jhi-alert-error></jhi-alert-error>
								<div row id="tabBackground" [formGroupName]="'0'">
									<div class="col-12">
										<div class="form-group" id="fromEndpointId" [hidden]="!fromEndpointId">
											<label for="id">ID</label>
											<input type="text" class="form-control" id="id" readonly formControlName="id" />
										</div>
										<div class="form-group">
											<label class="form-control-label" for="field_from_type">Component</label>
											<div class="input-group">
												<ng-select [items]="components.fromTypes" formControlName="type" id="field_from_type" (change)="setTypeLinks(fromEndpoint, 0, $event)"></ng-select>
												<a role="button" class="col-2 btn btn-outline-secondary left-border-radius-0 camel-link p-button-camel" href="{{fromTypeCamelLink}}" [ngClass]="{'disabled': !fromTypeCamelLink}" target="_blank" title="Camel {{fromEndpoint?.type}} component documentation">
													<img src="../../../content/images/apache-camel.png" />
												</a>
											</div>
											<div *ngIf="editFlowForm.controls.endpointsData.controls[0].controls.type.errors && (editFlowForm.controls.endpointsData.controls[0].controls.type.dirty || editFlowForm.controls.endpointsData.controls[0].controls.type.touched)">
												<div *ngIf="editFlowForm.controls.endpointsData.controls[0].controls.type.errors.required" class="invalid-field-message">Type is required. Please select one.</div>
											</div>
										</div>
										<div class="form-group">
											<label class="form-control-label" for="field_uri">Uri</label>
											<div class="input-group">
												<input type="text" class="form-control" id="field_uri" formControlName="uri" placeholder="{{fromUriPlaceholder}}" />
												<ng-template #uriPopover let-message="message">
													<div [innerHtml]="fromUriPopoverMessage"></div>
												</ng-template>
												<a role="button" class="col-2 btn btn-primary left-border-radius-0 p-question-button" href="{{fromTypeAssimblyLink}}" placement="left" target="_blank">
													<span class="fa fa-question" triggers="mouseenter:mouseleave" popoverTitle="URI Info" container="body" [popover]="uriPopover"></span>
												</a>
											</div>
											<div *ngIf="editFlowForm.controls.endpointsData.controls[0].controls.uri.errors && (editFlowForm.controls.endpointsData.controls[0].controls.uri.dirty || editFlowForm.controls.endpointsData.controls[0].controls.uri.touched)">
												<div *ngIf="editFlowForm.controls.endpointsData.controls[0].controls.uri.errors.required" class="invalid-field-message">Uri is required.</div>
											</div>
										</div>
										<div class="form-group" formArrayName="options">
											<label class="form-control-label" for="field_options">Options</label>
											<div class="row mx-0 mb-1" *ngFor="let fromOption of fromEndpointOptions; let idx = index" [formGroupName]="idx">
												<input type="text" class="col-5 right-border-radius-0 d-inline-block form-control" id="field_options-key-{{idx}}" placeholder="key" formControlName="key" (focusout)="validateOptions(editFlowForm.controls.endpointsData.controls[0].controls.options.controls[idx])" />
												<input type="text" class="col-5 rounded-0 d-inline-block form-control" id="field_options-value-{{idx}}" placeholder="value" formControlName="value" (focusout)="validateOptions(editFlowForm.controls.endpointsData.controls[0].controls.options.controls[idx])" />
												<button title="Add option" type="button" class="col-1 rounded-0 btn btn-primary" (click)="addOption(fromEndpointOptions, '0')"><span class="fa fa-plus"></span></button>
												<button title="Remove option" type="button" class="col-1 left-border-radius-0 btn btn-danger" (click)="removeOption(fromEndpointOptions, fromOption, '0')" [disabled]="fromEndpointOptions.length === 1"><span class="fa fa-remove"></span></button>
												<div class="col-5 d-inline-block px-0">
													<div *ngIf="editFlowForm.controls.endpointsData.controls[0].controls.options.controls[idx].controls.key.errors && (editFlowForm.controls.endpointsData.controls[0].controls.options.controls[idx].controls.key.dirty || editFlowForm.controls.endpointsData.controls[0].controls.options.controls[idx].controls.key.touched)">
														<div *ngIf="editFlowForm.controls.endpointsData.controls[0].controls.options.controls[idx].controls.key.errors.required" class="invalid-field-message">Option key is required.</div>
													</div>
												</div>
												<div class="col-5 d-inline-block px-0">
													<div *ngIf="editFlowForm.controls.endpointsData.controls[0].controls.options.controls[idx].controls.value.errors && (editFlowForm.controls.endpointsData.controls[0].controls.options.controls[idx].controls.value.dirty || editFlowForm.controls.endpointsData.controls[0].controls.options.controls[idx].controls.value.touched)">
														<div *ngIf="editFlowForm.controls.endpointsData.controls[0].controls.options.controls[idx].controls.value.errors.required" class="invalid-field-message">Option value is required.</div>
													</div>
												</div>
											</div>
										</div>
										<div class="form-group">
											<label class="form-control-label" for="field_header">Headers</label>
											<div class="input-group">
												<ng-select [items]="headers" bindLabel="name" bindValue="id" formControlName="header" id="field_header"></ng-select>
												<button type="button" *ngIf="headerCreated && editFlowForm.controls.endpointsData.controls[0].controls.header.value" class="col-2 btn btn-primary left-border-radius-0" title="Edit header" (click)="createOrEditHeader(fromEndpoint, editFlowForm.controls.endpointsData.controls[0].controls.header)">
													<span class="fa fa-pencil padding-button"></span>&nbsp;
												</button>
												<button type="button" *ngIf="headerCreated && !editFlowForm.controls.endpointsData.controls[0].controls.header.value" class="col-2 btn btn-primary left-border-radius-0" title="New header" (click)="createOrEditHeader(fromEndpoint, editFlowForm.controls.endpointsData.controls[0].controls.header)">
													<img class="h-20 padding-button" src="../../../content/images/new_page.png" />
												</button>
												<button type="button" *ngIf="!headerCreated" class="col-2 btn btn-primary left-border-radius-0" title="Create header" (click)="createOrEditHeader(fromEndpoint, editFlowForm.controls.endpointsData.controls[0].controls.header)">
													<span class="fa fa-plus padding-button"></span>&nbsp;
												</button>
											</div>
										</div>
										<div class="form-group">
											<label class="form-control-label" for="field_service">Service</label>
											<div class="input-group">
												<ng-select [items]="fromFilterService" bindLabel="name" bindValue="id" formControlName="service" id="field_service"></ng-select>
												<button type="button" *ngIf="serviceCreated && editFlowForm.controls.endpointsData.controls[0].controls.service.value" class="col-2 btn btn-primary left-border-radius-0" title="Edit service" (click)="createOrEditService(fromEndpoint, fromServiceType, editFlowForm.controls.endpointsData.controls[0].controls.service)">
													<span class="fa fa-pencil padding-button"></span>&nbsp;
												</button>
												<button type="button" *ngIf="serviceCreated && !editFlowForm.controls.endpointsData.controls[0].controls.service.value" class="col-2 btn btn-primary left-border-radius-0" title="New service" (click)="createOrEditService(fromEndpoint, fromServiceType, editFlowForm.controls.endpointsData.controls[0].controls.service)" [disabled]="editFlowForm.controls.endpointsData.controls[0].controls.service.disabled">
													<img class="h-20 padding-button" src="../../../content/images/new_page.png" />
												</button>
												<button type="button" *ngIf="!serviceCreated" class="col-2 btn btn-primary left-border-radius-0" title="Create service" (click)="createOrEditService(fromEndpoint, fromServiceType, editFlowForm.controls.endpointsData.controls[0].controls.service)">
													<span class="fa fa-plus padding-button"></span>&nbsp;
												</button>
											</div>
										</div>
									</div>
								</div>
							</ng-template>
						</ngb-tab>

						<ngb-tab title="To ({{toIndex+1}})" id="toTab{{toIndex}}" *ngFor="let toEndpoint of toEndpoints; index as toIndex">
							<ng-template ngbTabContent>
								<jhi-alert-error></jhi-alert-error>
								<div row id="tabBackground">
									<div class="col-12" [formGroupName]="toIndex+2">
										<div class="form-group" id="toEndpointId" [hidden]="!toEndpointId">
											<label for="id">ID</label>
											<input type="text" class="form-control" id="id" formControlName="id" readonly />
										</div>
										<div class="form-group">
											<label class="form-control-label" for="field_to_type">Component</label>
											<div class="input-group">
												<ng-select [items]="components.toTypes" formControlName="type" id="field_to_type" (change)="setTypeLinks(toEndpoint, toIndex+2, $event)"></ng-select>
												<a role="button" class="col-2 btn btn-outline-secondary left-border-radius-0 camel-link p-button-camel" href="{{toTypeCamelLinks[toIndex]}}" [ngClass]="{'disabled': !toTypeCamelLinks[toIndex]}" target="_blank" title="Camel {{toEndpoint?.type}} component documentation">
													<img src="../../../content/images/apache-camel.png" />
												</a>
											</div>
											<div *ngIf="editFlowForm.controls.endpointsData.controls[toIndex+2].controls.type.errors && (editFlowForm.controls.endpointsData.controls[toIndex+2].controls.type.dirty || editFlowForm.controls.endpointsData.controls[toIndex+2].controls.type.touched)">
												<div *ngIf="editFlowForm.controls.endpointsData.controls[toIndex+2].controls.type.errors.required" class="invalid-field-message">Type is required. Please select one.</div>
											</div>
										</div>
										<div class="form-group">
											<label class="form-control-label" for="field_uri">Uri</label>
											<div class="input-group">
												<input type="text" class="form-control" id="field_uri" formControlName="uri" placeholder="{{toUriPlaceholders[toIndex]}}" />
												<ng-template #uriPopover let-message="message">
													<div style="min-width:300px;" [innerHtml]="toUriPopoverMessages[toIndex]"></div>
												</ng-template>
												<a role="button" class="col-2 btn btn-primary left-border-radius-0 p-question-button" href="{{toTypeAssimblyLinks[toIndex]}}" placement="left" target="_blank">
													<span class="fa fa-question" triggers="mouseenter:mouseleave" popoverTitle="URI Info" container="body" [popover]="uriPopover"></span>
												</a>
											</div>
											<div *ngIf="editFlowForm.controls.endpointsData.controls[toIndex+2].controls.uri.errors && (editFlowForm.controls.endpointsData.controls[toIndex+2].controls.uri.dirty || editFlowForm.controls.endpointsData.controls[toIndex+2].controls.uri.touched)">
												<div *ngIf="editFlowForm.controls.endpointsData.controls[toIndex+2].controls.uri.errors.required" class="invalid-field-message">Uri is required.</div>
											</div>
										</div>
										<div class="form-group" formArrayName="options">
											<label class="form-control-label" for="field_options">Options</label>
											<div class="row mx-0 mb-1" *ngFor="let toOption of toEndpointsOptions[toIndex]; index as idx" [formGroupName]="idx">
												<input type="text" class="col-5 right-border-radius-0 d-inline-block form-control" id="field_options-key-{{idx}}" placeholder="key" formControlName="key" (focusout)="validateOptions(editFlowForm.controls.endpointsData.controls[toIndex+2].controls.options.controls[idx])"/>
												<input type="text" class="col-5 rounded-0 d-inline-block form-control" id="field_options-value-{{idx}}" placeholder="value" formControlName="value" (focusout)="validateOptions(editFlowForm.controls.endpointsData.controls[toIndex+2].controls.options.controls[idx])"/>
												<button title="Add option" type="button" class="col-1 rounded-0 btn btn-primary" (click)="addOption(toEndpointsOptions[toIndex], toIndex+2)" [disabled]="editFlowForm.controls.endpointsData.controls[toIndex+2].controls.type.value === 'WASTEBIN'"><span class="fa fa-plus"></span></button>
												<button title="Remove option" type="button" class="col-1 left-border-radius-0 btn btn-danger" (click)="removeOption(toEndpointsOptions[toIndex], toOption, toIndex+2)" [disabled]="editFlowForm.controls.endpointsData.controls[toIndex+2].controls.type.value === 'WASTEBIN' || toEndpointsOptions[toIndex].length === 1"><span class="fa fa-remove"></span></button>
												<div class="col-5 d-inline-block px-0">
													<div *ngIf="editFlowForm.controls.endpointsData.controls[toIndex+2].controls.options.controls[idx].controls.key.errors && (editFlowForm.controls.endpointsData.controls[toIndex+2].controls.options.controls[idx].controls.key.dirty || editFlowForm.controls.endpointsData.controls[toIndex+2].controls.options.controls[idx].controls.key.touched)">
														<div *ngIf="editFlowForm.controls.endpointsData.controls[toIndex+2].controls.options.controls[idx].controls.key.errors.required" class="invalid-field-message">Option key is required.</div>
													</div>
												</div>
												<div class="col-5 d-inline-block px-0">
													<div *ngIf="editFlowForm.controls.endpointsData.controls[toIndex+2].controls.options.controls[idx].controls.value.errors && (editFlowForm.controls.endpointsData.controls[toIndex+2].controls.options.controls[idx].controls.value.dirty || editFlowForm.controls.endpointsData.controls[toIndex+2].controls.options.controls[idx].controls.value.touched)">
														<div *ngIf="editFlowForm.controls.endpointsData.controls[toIndex+2].controls.options.controls[idx].controls.value.errors.required" class="invalid-field-message">Option value is required.</div>
													</div>
												</div>
											</div>
										</div>
										<div class="form-group">
											<label class="form-control-label" for="field_header">Headers</label>
											<div class="input-group">
												<ng-select [items]="headers" bindLabel="name" bindValue="id" formControlName="header" id="field_header"></ng-select>
												<button type="button" *ngIf="headerCreated && editFlowForm.controls.endpointsData.controls[toIndex+2].controls.header.value" title="Edit header" class="col-2 btn btn-primary left-border-radius-0" (click)="createOrEditHeader(toEndpoint, editFlowForm.controls.endpointsData.controls[toIndex+2].controls.header)" [disabled]="editFlowForm.controls.endpointsData.controls[toIndex+2].controls.type.value === 'WASTEBIN'">
													<span class="fa fa-pencil  padding-button"></span>&nbsp;
												</button>
												<button type="button" *ngIf="headerCreated && !editFlowForm.controls.endpointsData.controls[toIndex+2].controls.header.value" class="col-2 btn btn-primary left-border-radius-0" title="New header" (click)="createOrEditHeader(toEndpoint, editFlowForm.controls.endpointsData.controls[toIndex+2].controls.header)" [disabled]="editFlowForm.controls.endpointsData.controls[toIndex+2].controls.type.value === 'WASTEBIN'">
													<img class="h-20 padding-button" src="../../../content/images/new_page.png" />
												</button>
												<button type="button" *ngIf="!headerCreated" class="col-2 btn btn-primary left-border-radius-0" title="Create header" (click)="createOrEditHeader(toEndpoint, editFlowForm.controls.endpointsData.controls[toIndex+2].controls.header)" [disabled]="editFlowForm.controls.endpointsData.controls[toIndex+2].controls.type.value === 'WASTEBIN'">
													<span class="fa fa-plus padding-button"></span>&nbsp;
												</button>
											</div>
										</div>

										<div class="form-group">
											<label class="form-control-label" for="field_service">Service</label>
											<div class="input-group">
												<ng-select [items]="toFilterService[toIndex]" bindLabel="name" bindValue="id" formControlName="service" id="field_service"></ng-select>
												<button type="button" *ngIf="serviceCreated && editFlowForm.controls.endpointsData.controls[toIndex+2].controls.service.value" class="col-2 btn btn-primary left-border-radius-0" title="Edit service" (click)="createOrEditService(toEndpoint, toServiceType[toIndex], editFlowForm.controls.endpointsData.controls[toIndex+2].controls.service)" [disabled]="editFlowForm.controls.endpointsData.controls[toIndex+2].controls.type.value === 'WASTEBIN'">
													<span class="fa fa-pencil padding-button"></span>&nbsp;
												</button>
												<button type="button" *ngIf="serviceCreated && !editFlowForm.controls.endpointsData.controls[toIndex+2].controls.service.value" class="col-2 btn btn-primary left-border-radius-0" title="New service" (click)="createOrEditService(toEndpoint, toServiceType[toIndex], editFlowForm.controls.endpointsData.controls[toIndex+2].controls.service)" [disabled]="editFlowForm.controls.endpointsData.controls[toIndex+2].controls.service.disabled">
													<img class="h-20 padding-button" src="../../../content/images/new_page.png" />
												</button>
												<button type="button" *ngIf="!serviceCreated" class="col-2 btn btn-primary left-border-radius-0" title="Create service" (click)="createOrEditService(toEndpoint, toServiceType[toIndex], editFlowForm.controls.endpointsData.controls[toIndex+2].controls.service)" [disabled]="editFlowForm.controls.endpointsData.controls[toIndex+2].controls.type.value === 'WASTEBIN'">
													<span class="fa fa-plus padding-button"></span>&nbsp;
												</button>
											</div>
										</div>
										<div class="text-right form-group" role="group">
											<button type="button" class="btn btn-danger" (click)="removeToEndpoint(toEndpoint, 'toEndpointData'+toIndex)" [disabled]="toEndpoints.length === 1">
												<span class="fa fa-remove"></span>&nbsp;
												<span>Remove To endpoint</span>
											</button>
											<button type="button" class="btn btn-primary" (click)="addNewToEndpoint()" [disabled]="toEndpoints.length > 2">
												<span class="fa fa-pencil"></span>&nbsp;
												<span>Add To endpoint</span>
											</button>
										</div>
									</div>
								</div>
							</ng-template>
						</ngb-tab>

						<ngb-tab title="Error" id="errorTab">
							<ng-template ngbTabContent>
								<div row id="tabBackground" [formGroupName]="'1'">
									<div class="col-12">
										<div class="form-group" id="errorEndpointId" [hidden]="!errorEndpointId">
											<label for="id">ID</label>
											<input type="text" class="form-control" id="id" formControlName="id" readonly />
										</div>
										<div class="form-group">
											<label class="form-control-label" for="field_error_type">Component</label>
											<div class="input-group">
												<ng-select [items]="components.errorTypes" formControlName="type" id="field_error_type" (change)="setTypeLinks(errorEndpoint, 1, $event)"></ng-select>
												<a role="button" class="col-2 btn btn-outline-secondary left-border-radius-0 camel-link p-button-camel" href="{{errorTypeCamelLink}}" [ngClass]="{'disabled': !errorTypeCamelLink}" target="_blank" title="Camel {{errorEndpoint?.type}} component documentation">
													<img src="../../../content/images/apache-camel.png" />
												</a>
											</div>
											<div *ngIf="editFlowForm.controls.endpointsData.controls[1].controls.type.errors && (editFlowForm.controls.endpointsData.controls[1].controls.type.dirty || editFlowForm.controls.endpointsData.controls[1].controls.type.touched)">
												<div *ngIf="editFlowForm.controls.endpointsData.controls[1].controls.type.errors.required" class="invalid-field-message">Type is required. Please select one.</div>
											</div>
										</div>
										<div class="form-group">
											<label class="form-control-label" for="field_uri">Uri</label>
											<div class="input-group">
												<input type="text" class="form-control" id="field_uri" formControlName="uri" placeholder="{{toUriPlaceholders[toIndex]}}" />
												<ng-template #uriPopover let-message="message">
													<div style="min-width:300px;" [innerHtml]="errorUriPopoverMessage"></div>
												</ng-template>
												<a role="button" class="col-2 btn btn-primary left-border-radius-0 p-question-button" href="{{errorTypeAssimblyLink}}" placement="left" target="_blank">
													<span class="fa fa-question" triggers="mouseenter:mouseleave" popoverTitle="URI Info" container="body" [popover]="uriPopover"></span>
												</a>
											</div>
											<div *ngIf="editFlowForm.controls.endpointsData.controls[1].controls.uri.errors && (editFlowForm.controls.endpointsData.controls[1].controls.uri.dirty || editFlowForm.controls.endpointsData.controls[1].controls.uri.touched)">
												<div *ngIf="editFlowForm.controls.endpointsData.controls[1].controls.uri.errors.required" class="invalid-field-message">Uri is required.</div>
											</div>
										</div>
										<div class="form-group" formArrayName="options">
											<label class="form-control-label" for="field_options">Options</label>
											<div class="row mx-0 mb-1" *ngFor="let errOption of errorEndpointOptions; let idx = index" [formGroupName]="idx">
												<input type="text" class="col-5 right-border-radius-0 d-inline-block form-control" id="field_options-key-{{idx}}" placeholder="key" formControlName="key" (focusout)="validateOptions(editFlowForm.controls.endpointsData.controls[1].controls.options.controls[idx])" />
												<input type="text" class="col-5 rounded-0 d-inline-block form-control" id="field_options-value-{{idx}}" placeholder="value" formControlName="value" (focusout)="validateOptions(editFlowForm.controls.endpointsData.controls[1].controls.options.controls[idx])" />
												<button title="Add option" type="button" class="col-1 rounded-0 btn btn-primary" (click)="addOption(errorEndpointOptions, '1')"><span class="fa fa-plus"></span></button>
												<button title="Remove option" type="button" class="col-1 left-border-radius-0 btn btn-danger" (click)="removeOption(errorEndpointOptions, errOption, '1')" [disabled]="errorEndpointOptions.length === 1"><span class="fa fa-remove"></span></button>
												<div class="col-5 d-inline-block px-0">
													<div *ngIf="editFlowForm.controls.endpointsData.controls[1].controls.options.controls[idx].controls.key.errors && (editFlowForm.controls.endpointsData.controls[1].controls.options.controls[idx].controls.key.dirty || editFlowForm.controls.endpointsData.controls[1].controls.options.controls[idx].controls.key.touched)">
														<div *ngIf="editFlowForm.controls.endpointsData.controls[1].controls.options.controls[idx].controls.key.errors.required" class="invalid-field-message">Option key is required.</div>
													</div>
												</div>
												<div class="col-5 d-inline-block px-0">
													<div *ngIf="editFlowForm.controls.endpointsData.controls[1].controls.options.controls[idx].controls.value.errors && (editFlowForm.controls.endpointsData.controls[1].controls.options.controls[idx].controls.value.dirty || editFlowForm.controls.endpointsData.controls[1].controls.options.controls[idx].controls.value.touched)">
														<div *ngIf="editFlowForm.controls.endpointsData.controls[1].controls.options.controls[idx].controls.value.errors.required" class="invalid-field-message">Option value is required.</div>
													</div>
												</div>
											</div>
										</div>
										<div class="form-group">
											<label class="form-control-label" for="field_header">Headers</label>
											<div class="input-group">
												<ng-select [items]="headers" bindLabel="name" bindValue="id" formControlName="header" id="field_header"></ng-select>
												<button type="button" *ngIf="headerCreated && editFlowForm.controls.endpointsData.controls[1].controls.header.value" class="col-2 btn btn-primary left-border-radius-0" title="Edit header" (click)="createOrEditHeader(errorEndpoint, editFlowForm.controls.endpointsData.controls[1].controls.header)">
													<span class="fa fa-pencil padding-button"></span>&nbsp;
												</button>
												<button type="button" *ngIf="headerCreated && !editFlowForm.controls.endpointsData.controls[1].controls.header.value" class="col-2 btn btn-primary left-border-radius-0" title="New header" (click)="createOrEditHeader(errorEndpoint, editFlowForm.controls.endpointsData.controls[1].controls.header)">
													<img class="h-20 padding-button" src="../../../content/images/new_page.png" />
												</button>
												<button type="button" *ngIf="!headerCreated" class="col-2 btn btn-primary left-border-radius-0" title="Create header" (click)="createOrEditHeader(errorEndpoint, editFlowForm.controls.endpointsData.controls[1].controls.header)">
													<span class="fa fa-plus padding-button"></span>&nbsp;
												</button>
											</div>
										</div>
										<div class="form-group">
											<label class="form-control-label" for="field_service">Service</label>
											<div class="input-group">
												<ng-select [items]="errorFilterService" bindLabel="name" bindValue="id" formControlName="service" id="field_service"></ng-select>
												<button type="button" *ngIf="serviceCreated && editFlowForm.controls.endpointsData.controls[1].controls.service.value" class="col-2 btn btn-primary left-border-radius-0" title="Edit service" (click)="createOrEditService(errorEndpoint, errorServiceType, editFlowForm.controls.endpointsData.controls[1].controls.service)">
													<span class="fa fa-pencil padding-button"></span>&nbsp;
												</button>
												<button type="button" *ngIf="serviceCreated && !editFlowForm.controls.endpointsData.controls[1].controls.service.value" class="col-2 btn btn-primary left-border-radius-0" title="New service" (click)="createOrEditService(errorEndpoint, errorServiceType, editFlowForm.controls.endpointsData.controls[1].controls.service)" [disabled]="editFlowForm.controls.endpointsData.controls[1].controls.service.disabled">
													<img class="h-20 padding-button" src="../../../content/images/new_page.png" />
												</button>
												<button type="button" *ngIf="!serviceCreated" class="col-2 btn btn-primary left-border-radius-0" title="Create service" (click)="createOrEditService(errorEndpoint, errorServiceType, editFlowForm.controls.endpointsData.controls[1].controls.service)">
													<span class="fa fa-plus padding-button"></span>&nbsp;
												</button>
											</div>
										</div>
									</div>
								</div>
							</ng-template>
						</ngb-tab>
					</ngb-tabset>
				</div>

				<div class="float-right">
					<button type="button" class="btn btn-secondary" [routerLink]="['/']">
						<span class="fa fa-ban"></span>&nbsp;
						<span>Cancel</span>
					</button>
					<button type="submit" *ngIf="!displayNextButton" [disabled]="editFlowForm.invalid || isSaving" class="btn btn-primary">
						<span class="fa fa-save"></span>&nbsp;
						<span>Apply</span>
					</button>
					<button type="button" (click)="save(true)" *ngIf="!displayNextButton" [disabled]="editFlowForm.invalid || isSaving" class="btn btn-primary">
						<span class="fa fa-save"></span>&nbsp;
						<span>Save</span>
					</button>
					<button type="button" (click)="next(true)" *ngIf="displayNextButton" class="btn btn-primary">
						<span>Next</span>&nbsp;
						<span class="fa fa-arrow-right"></span>
					</button>
					<button type="button" *ngIf="!displayNextButton && flow.id" (click)="load(flow.id, true)" class="btn btn-info">
						<span class="fa fa-clone"></span>&nbsp;
						<span> Clone</span>
					</button>
					<button type="button" *ngIf="!displayNextButton && flow.id" [routerLink]="['/', { outlets: { popup: 'flow/'+ flow.id + '/delete'} }]" replaceUrl="true" queryParamsHandling="merge" class="btn btn-danger">
						<span class="fa fa-remove"></span>
						<span class="d-none d-md-inline">Delete</span>
					</button>
				</div>
				<div *ngIf="savingFlowFailed">
					<span class="text-danger">*{{savingFlowFailedMessage}}</span>
				</div>
				<div *ngIf="savingFlowSuccess">
					<span class="text-success">*{{savingFlowSuccessMessage}}</span>
				</div>
				<div *ngIf="!!invalidUriMessage">
					<span class="text-danger">*{{invalidUriMessage}}</span>
				</div>
			</form>
		</div>
	</div>
</div>